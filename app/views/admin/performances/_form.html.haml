= form_for [:admin, @performance] do |f|
  -if @performance.errors.any?
    #error_explanation
      %h2= "#{pluralize(@performance.errors.count, "error")} prohibited this performance from being saved:"
      %ul
        - @performance.errors.full_messages.each do |msg|
          %li= msg

  = f.label 'Main Performer'
  = collection_select(:performance, :person_id, Person.performers.order('canonical_name'), :id,
                      :canonical_name, {:prompt => 'Select a Performer'}, {:class => "chzn-select"})
  - if can? :create, :person
    %a#create_performer{href:'javascript:void(0)'} Create New Performer
    #performer_fields

  = f.label :composition_tokens, 'Composition'
  = f.text_field :composition_tokens,
  { 'data' => @performance.composition ? { :load => CompositionDecorator.decorate([@performance.composition]) } : {} }
  - if can? :create, :composition
    &nbsp;
    = link_to 'Create New Composition', new_admin_composition_path, :class => 'btn btn-small'

  = f.label 'Performance Type'
  = collection_select(:performance, :performance_type_id, PerformanceType.order('name'), :id,
                      :name, {:prompt => 'Select a Performance Type'}, {:class => "chzn-select"})

  = f.label 'URL'
  = f.fields_for :url do |b|
    %div.span4
      %fieldset.well
        = b.label 'URL'
        = b.text_field :http, {:class => 'input-large'}
        = b.label 'Embed Code'
        = b.text_area :embeded_code

    %div.span4
      #video.well
        !=@performance.url.embeded_code

  .clearfix

  %h1 Additional Roles
  = f.fields_for :performance_roles do |b|
    = collection_select(:performance_role, :person_id, Person.by_canonical_name, :id,
                      :canonical_name, {:prompt => 'Select a Person', :class => "chzn-select"})
    = b.label 'Role'
    = b.text_field :role_name

  .actions
    = f.submit 'Save'
